<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Sort Visualizer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM via ESM -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
        
        /* Animation for description text */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        
        body {
            background-color: #0f172a; /* Slate 900 */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Play, Pause, SkipBack, SkipForward, RotateCcw, ArrowRightLeft, Settings, Activity, BarChart2, Hash, CheckCircle2 } from 'lucide-react';

        const BubbleSortVisualizer = () => {
            // -- State --
            const [arraySize, setArraySize] = useState(10);
            const [animationSpeed, setAnimationSpeed] = useState(500); 
            const [steps, setSteps] = useState([]);
            const [currentStepIndex, setCurrentStepIndex] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            
            // Refs
            const timerRef = useRef(null);

            // -- Colors --
            const COLORS = {
                default: 'bg-slate-600',
                comparing: 'bg-amber-500', // Comparing two elements
                swapping: 'bg-indigo-500', // Swapping elements
                sorted: 'bg-emerald-500',  // In final position
                barDefault: 'bg-slate-600',
            };

            // -- Algorithm Logic --
            const generateRandomArray = (size) => {
                return Array.from({ length: size }, () => Math.floor(Math.random() * 90) + 10);
            };

            const generateSteps = (initialArray) => {
                let arr = [...initialArray];
                let stepsLog = [];
                let n = arr.length;
                let comparisons = 0;
                let swaps = 0;
                let sortedIndices = [];

                // Step 0: Initial state
                stepsLog.push({
                    type: 'initial',
                    array: [...arr],
                    comparing: [],
                    swapping: [],
                    sorted: [],
                    comparisons: 0,
                    swaps: 0,
                    description: `Initial Array. Ready to perform Bubble Sort.`
                });

                for (let i = 0; i < n; i++) {
                    for (let j = 0; j < n - i - 1; j++) {
                        // Compare Step
                        comparisons++;
                        stepsLog.push({
                            type: 'compare',
                            array: [...arr],
                            comparing: [j, j+1],
                            swapping: [],
                            sorted: [...sortedIndices],
                            comparisons,
                            swaps,
                            description: `Comparing indices ${j} (${arr[j]}) and ${j+1} (${arr[j+1]}).`
                        });

                        if (arr[j] > arr[j+1]) {
                            // Swap logic in memory
                            let temp = arr[j];
                            arr[j] = arr[j+1];
                            arr[j+1] = temp;
                            swaps++;

                            // Swap Step
                            stepsLog.push({
                                type: 'swap',
                                array: [...arr],
                                comparing: [],
                                swapping: [j, j+1], // Highlight as swapping
                                sorted: [...sortedIndices],
                                comparisons,
                                swaps,
                                description: `Swapping ${arr[j+1]} and ${arr[j]} because ${arr[j+1]} > ${arr[j]}.`
                            });
                        }
                    }
                    
                    // Mark last element as sorted
                    sortedIndices.push(n - 1 - i);
                    stepsLog.push({
                        type: 'sorted_mark',
                        array: [...arr],
                        comparing: [],
                        swapping: [],
                        sorted: [...sortedIndices],
                        comparisons,
                        swaps,
                        description: `Element ${arr[n - 1 - i]} is now in its sorted position.`
                    });
                }

                // Final Step
                stepsLog.push({
                    type: 'finished',
                    array: [...arr],
                    comparing: [],
                    swapping: [],
                    sorted: Array.from({length: n}, (_, k) => k),
                    comparisons,
                    swaps,
                    description: `Sort Complete. Total Comparisons: ${comparisons}, Total Swaps: ${swaps}.`
                });

                return stepsLog;
            };

            // -- Effects --
            useEffect(() => {
                reset();
            }, [arraySize]); 

            const reset = () => {
                setIsPlaying(false);
                setCurrentStepIndex(0);
                const newArr = generateRandomArray(arraySize);
                const generatedSteps = generateSteps(newArr);
                setSteps(generatedSteps);
            };

            useEffect(() => {
                if (isPlaying) {
                    timerRef.current = setInterval(() => {
                        setCurrentStepIndex((prev) => {
                            if (prev < steps.length - 1) {
                                return prev + 1;
                            } else {
                                setIsPlaying(false);
                                clearInterval(timerRef.current);
                                return prev;
                            }
                        });
                    }, 2000 - animationSpeed);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [isPlaying, steps.length, animationSpeed]);


            // -- Controls --
            const handleNext = () => {
                if (currentStepIndex < steps.length - 1) {
                    setCurrentStepIndex(prev => prev + 1);
                    setIsPlaying(false);
                }
            };

            const handlePrev = () => {
                if (currentStepIndex > 0) {
                    setCurrentStepIndex(prev => prev - 1);
                    setIsPlaying(false);
                }
            };

            const togglePlay = () => {
                if (currentStepIndex === steps.length - 1) { 
                    reset();
                    setTimeout(() => setIsPlaying(true), 100); 
                } else {
                    setIsPlaying(!isPlaying);
                }
            };


            // -- Render Helpers --
            const getCurrentStep = () => steps[currentStepIndex] || { 
                array: [], comparing: [], swapping: [], sorted: [], description: "Loading..." 
            };

            const getBarColor = (index, step) => {
                if (step.sorted.includes(index)) return COLORS.sorted;
                if (step.swapping.includes(index)) return COLORS.swapping;
                if (step.comparing.includes(index)) return COLORS.comparing;
                return COLORS.default;
            };

            const getOpacity = (index, step) => {
                // Dim elements that are not active if we are comparing/swapping others
                const isActive = step.comparing.includes(index) || step.swapping.includes(index) || step.sorted.includes(index);
                if ((step.comparing.length > 0 || step.swapping.length > 0) && !isActive) {
                    return 'opacity-60';
                }
                return 'opacity-100';
            };

            const step = getCurrentStep();

            return (
                React.createElement("div", { className: "flex flex-col items-center justify-center min-h-screen bg-slate-900 text-slate-100 font-sans p-4 sm:p-8" },
                    
                    /* Title */
                    React.createElement("div", { className: "w-full max-w-7xl mb-6 flex items-center gap-3 justify-start" },
                        React.createElement(BarChart2, { size: 32, className: "text-indigo-400" }),
                        React.createElement("h1", { className: "text-2xl sm:text-3xl font-bold text-indigo-400 whitespace-nowrap tracking-tight" }, "Bubble Sort")
                    ),

                    /* Main Layout */
                    React.createElement("div", { className: "flex flex-col lg:flex-row gap-6 w-full max-w-7xl items-start" },
                        
                        /* Sidebar: Controls */
                        React.createElement("div", { className: "w-full lg:w-72 flex flex-col gap-4 shrink-0" },
                            
                            /* Settings Card */
                            React.createElement("div", { className: "bg-slate-800 rounded-xl border border-slate-700 p-5 shadow-lg flex flex-col gap-6" },
                                React.createElement("div", { className: "flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider" },
                                    React.createElement(Settings, { size: 14 }), "Settings"
                                ),
                                React.createElement("div", { className: "flex flex-col gap-2" },
                                    React.createElement("div", { className: "flex justify-between items-center" },
                                        React.createElement("span", { className: "text-xs text-slate-400" }, "Array Size"),
                                        React.createElement("span", { className: "text-xs font-mono text-indigo-300 bg-indigo-900/30 px-2 py-0.5 rounded" }, arraySize)
                                    ),
                                    React.createElement("input", {
                                        type: "range", min: "5", max: "20", step: "1",
                                        value: arraySize,
                                        onChange: (e) => setArraySize(Number(e.target.value)),
                                        disabled: isPlaying,
                                        className: "w-full h-1.5 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-indigo-500 disabled:opacity-50"
                                    })
                                )
                            ),

                            /* Playback Controls */
                            React.createElement("div", { className: "bg-slate-800 rounded-xl border border-slate-700 p-5 shadow-lg flex flex-col gap-4" },
                                React.createElement("div", { className: "flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider mb-1" },
                                    React.createElement(Activity, { size: 14 }), "Playback Controls"
                                ),
                                React.createElement("div", { className: "flex items-center justify-between gap-2" },
                                    React.createElement("button", { onClick: reset, className: "p-3 text-slate-400 hover:text-white hover:bg-slate-700 rounded-xl transition-colors bg-slate-700/30", title: "Reset / Shuffle" },
                                        React.createElement(RotateCcw, { size: 18 })
                                    ),
                                    React.createElement("div", { className: "flex items-center gap-2" },
                                        React.createElement("button", { onClick: handlePrev, disabled: currentStepIndex === 0, className: "p-3 text-slate-400 hover:text-white hover:bg-slate-700 disabled:opacity-30 rounded-xl transition-colors bg-slate-700/30" },
                                            React.createElement(SkipBack, { size: 18 })
                                        ),
                                        React.createElement("button", { 
                                            onClick: togglePlay, 
                                            className: "p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-900/50 transition-all hover:scale-105 active:scale-95 mx-1"
                                        },
                                            isPlaying 
                                                ? React.createElement(Pause, { size: 22, fill: "currentColor" }) 
                                                : React.createElement(Play, { size: 22, fill: "currentColor", className: "ml-0.5" })
                                        ),
                                        React.createElement("button", { onClick: handleNext, disabled: currentStepIndex === steps.length - 1, className: "p-3 text-slate-400 hover:text-white hover:bg-slate-700 disabled:opacity-30 rounded-xl transition-colors bg-slate-700/30" },
                                            React.createElement(SkipForward, { size: 18 })
                                        )
                                    )
                                ),
                                React.createElement("div", { className: "h-px w-full bg-slate-700/50 my-1" }),
                                React.createElement("div", { className: "flex flex-col gap-2" },
                                    React.createElement("div", { className: "flex justify-between items-center" },
                                        React.createElement("span", { className: "text-xs text-slate-400" }, "Animation Speed"),
                                        React.createElement("span", { className: "text-xs font-mono text-emerald-300 bg-emerald-900/30 px-2 py-0.5 rounded" }, `${(animationSpeed/1000).toFixed(1)}s`)
                                    ),
                                    React.createElement("input", {
                                        type: "range", min: "100", max: "1500", step: "100",
                                        value: animationSpeed,
                                        onChange: (e) => setAnimationSpeed(Number(e.target.value)),
                                        className: "w-full h-1.5 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-emerald-500"
                                    })
                                )
                            )
                        ),

                        /* Main Visualization */
                        React.createElement("div", { className: "flex-1 w-full flex flex-col gap-4" },
                            
                            /* Description Box */
                            React.createElement("div", { className: "w-full min-h-[70px] bg-slate-800 rounded-xl border border-slate-700 p-4 flex items-center justify-center shadow-lg" },
                                React.createElement("p", { className: "text-lg text-slate-100 font-medium leading-relaxed text-center animate-fade-in" }, step.description)
                            ),

                            /* Content Box */
                            React.createElement("div", { className: "w-full bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col gap-4" },
                                
                                /* Stats & Legend */
                                React.createElement("div", { className: "flex flex-col sm:flex-row justify-between items-center gap-4 w-full" },
                                    
                                    /* Stats Counters (Replaces Target) */
                                    React.createElement("div", { className: "flex gap-4" },
                                        React.createElement("div", { className: "flex items-center gap-2 px-3 py-1 bg-slate-900/50 rounded-md border border-slate-600" },
                                            React.createElement(Hash, { size: 14, className: "text-amber-400" }),
                                            React.createElement("span", { className: "text-[10px] sm:text-xs text-slate-400 font-bold uppercase" }, "Compares"),
                                            React.createElement("span", { className: "text-sm font-bold text-slate-200 font-mono" }, step.comparisons || 0)
                                        ),
                                        React.createElement("div", { className: "flex items-center gap-2 px-3 py-1 bg-slate-900/50 rounded-md border border-slate-600" },
                                            React.createElement(ArrowRightLeft, { size: 14, className: "text-indigo-400" }),
                                            React.createElement("span", { className: "text-[10px] sm:text-xs text-slate-400 font-bold uppercase" }, "Swaps"),
                                            React.createElement("span", { className: "text-sm font-bold text-slate-200 font-mono" }, step.swaps || 0)
                                        )
                                    ),

                                    /* Legend */
                                    React.createElement("div", { className: "flex flex-wrap justify-center sm:justify-end gap-x-6 gap-y-2 text-xs font-medium text-slate-300" },
                                        React.createElement("div", { className: "flex items-center gap-2" },
                                            React.createElement("div", { className: `w-2.5 h-2.5 rounded-full ${COLORS.comparing}` }), "Compare"
                                        ),
                                        React.createElement("div", { className: "flex items-center gap-2" },
                                            React.createElement("div", { className: `w-2.5 h-2.5 rounded-full ${COLORS.swapping}` }), "Swap"
                                        ),
                                        React.createElement("div", { className: "flex items-center gap-2" },
                                            React.createElement("div", { className: `w-2.5 h-2.5 rounded-full ${COLORS.sorted}` }), "Sorted"
                                        )
                                    )
                                ),

                                React.createElement("div", { className: "w-full h-px bg-slate-700/50 my-1" }),

                                /* Array Nodes (Top View) */
                                React.createElement("div", { className: "flex flex-col items-center w-full mt-2" },
                                    React.createElement("h3", { className: "text-xs font-bold tracking-wider text-slate-500 mb-3 uppercase" }, "Array Values"),
                                    React.createElement("div", { className: "flex justify-center flex-wrap w-full gap-2 px-4" },
                                        (step.array || []).map((val, idx) => {
                                            const isComparing = step.comparing.includes(idx);
                                            const isSwapping = step.swapping.includes(idx);
                                            const isSorted = step.sorted.includes(idx);
                                            
                                            let boxClass = 'bg-slate-800 text-slate-300 border-slate-600';
                                            if (isSorted) boxClass = 'bg-emerald-900 text-emerald-100 border-emerald-500 shadow-md';
                                            else if (isSwapping) boxClass = 'bg-indigo-900 text-indigo-100 border-indigo-500 border-2 shadow-indigo-500/50 shadow-md -translate-y-2 scale-110';
                                            else if (isComparing) boxClass = 'bg-amber-900 text-amber-100 border-amber-500 border-2 shadow-amber-500/50 shadow-md -translate-y-1';

                                            return React.createElement("div", { 
                                                key: idx,
                                                className: `relative w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-md font-bold text-sm sm:text-base transition-all duration-300 border ${boxClass}`
                                            }, val)
                                        })
                                    )
                                ),

                                /* Bar Chart (Bottom View) */
                                React.createElement("div", { className: "relative w-full h-64 sm:h-80 bg-slate-900/50 rounded-lg p-4 flex items-end justify-center overflow-hidden mt-4 border border-slate-800" },
                                    React.createElement("div", { className: "absolute inset-0 opacity-5 pointer-events-none", style: { backgroundImage: 'radial-gradient(#94a3b8 1px, transparent 1px)', backgroundSize: '20px 20px' } }),
                                    React.createElement("div", { className: "flex items-end justify-center w-full h-full gap-1 sm:gap-2 z-10" },
                                        (step.array || []).map((val, idx) => {
                                            const heightPct = (val / 100) * 100;
                                            return React.createElement("div", { key: idx, className: `h-full flex flex-col items-center justify-end w-full max-w-[3rem] transition-opacity duration-200 ${getOpacity(idx, step)}` },
                                                React.createElement("div", { 
                                                    className: `w-full rounded-t-md transition-all duration-200 ease-in-out shadow-lg ${getBarColor(idx, step)}`,
                                                    style: { height: `${heightPct}%` }
                                                })
                                            );
                                        })
                                    )
                                ),

                                /* Footer / Progress */
                                React.createElement("div", { className: "w-full flex justify-between items-center text-sm text-slate-400 border-t border-slate-700 pt-4 mt-2" },
                                    React.createElement("span", null, `STEP ${currentStepIndex} / ${steps.length > 0 ? steps.length - 1 : 0}`),
                                    React.createElement("div", { className: "w-32 sm:w-64 h-1 bg-slate-700 rounded-full mx-4" },
                                        React.createElement("div", { 
                                            className: "h-full bg-indigo-500 rounded-full transition-all duration-100",
                                            style: { width: `${steps.length > 1 ? (currentStepIndex / (steps.length - 1)) * 100 : 0}%` }
                                        })
                                    ),
                                    React.createElement("div", { className: "flex items-center gap-2" },
                                        step.type === 'finished' && React.createElement(CheckCircle2, { size: 16, className: "text-emerald-500" }),
                                        React.createElement("span", null, step.type === 'finished' ? "Sorted" : "Sorting...")
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(BubbleSortVisualizer));
    </script>
</body>
</html>